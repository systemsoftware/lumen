<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History</title>
    <link rel="stylesheet" href="./style.css">
    <script src="./marked.min.js"></script>
</head>
<br>
<h2>Search History</h2>
<body></body>

<script>

window.electronAPI.getHistory().then((history) => {
  history.forEach((entry) => {
    console.log('History entry:', entry);
    const entryElement = document.createElement('div');
    entryElement.classList.add('history-entry');
    entryElement.style.marginBottom = '20px';
    entryElement.innerHTML = `
        <h3 class="history-entry-timestamp">${new Date(entry.timestamp).toLocaleString()}</h3>
      ${entry.response ? `<details class="history-entry-content">
        <summary>Content</summary>
        ${marked.parse(entry.response)}
      </details>` : ''}
        ${entry.ocr ? `<br><details class="history-entry-ocr">
            <summary>OCR Text</summary>
            ${entry.ocr}
        </details>` : ''}
        <br>
        <button onclick="deleteEntry('${entry.id}')">Delete</button>
    `;
    document.body.appendChild(entryElement);
  });
});

const deleteEntry = (id) => {
  if (confirm('Are you sure you want to delete this entry?')) {
    window.electronAPI.deleteHistoryEntry(id).then(() => {
      location.reload();
    });
  }
};

</script>